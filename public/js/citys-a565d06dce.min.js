!function(e){"function"==typeof define&&(define.amd||define.cmd)?define(["jquery"],function(){e(jQuery)}):e(jQuery)}(function(e){e.fn.grade=function(o,n){"function"==typeof o?(n=o,o={}):(o=o||{},n=n||function(){});var c={dataUrl:"",dataType:"json",provinceField:"",cityField:"",areaField:"",code:0,province:"",city:"",area:"",required:!0,nodata:"hidden",onChange:function(){}},a=e.extend({},c,o);return this.each(function(){var o={},c=e(this),t=c.find('select[name="'+a.provinceField+'"]'),d=c.find('select[name="'+a.cityField+'"]'),r=c.find('select[name="'+a.areaField+'"]');e.ajax({url:a.dataUrl,type:"GET",dataType:a.dataType,jsonpCallback:"jsonp_location",success:function(c){var p,y,f,v;if(a.code){var u=a.code-a.code%1e4;c[u]&&(a.province=u),u=a.code-(a.code%1e4?a.code%100:a.code),c[u]&&(a.city=u),u=a.code%100?a.code:0,c[u]&&(a.area=u)}var s=function(){p={},y={},f={},v=!1;for(code in c)if(code%1e4){var e=code-a.province;if(a.province&&e>0&&e<1e4)if(code%100)if(e>9e3)y[code]=c[code];else if(v){var i=code-a.city;a.city&&i>0&&i<100&&(f[code]=c[code],a.required&&!a.area?a.area=code:c[code].indexOf(a.area)>-1&&(a.area=isNaN(a.area)?code:a.area))}else y[code]=c[code],a.area&&(a.city=a.area,a.area=""),a.required&&!a.city?a.city=code:c[code].indexOf(a.city)>-1&&(a.city=isNaN(a.city)?code:a.city);else v=!0,y[code]=c[code],a.required&&!a.city?a.city=code:c[code].indexOf(a.city)>-1&&(a.city=isNaN(a.city)?code:a.city)}else p[code]=c[code],a.required&&!a.province?!a.city||a.city%1e4?a.province=code:a.province=a.city:c[code].indexOf(a.province)>-1&&(a.province=isNaN(a.province)?code:a.province)},l={province:function(){t.empty(),a.required||t.append('<option value="">选择年级组</option>');for(i in p)t.append('<option value="'+i+'">'+p[i]+"</option>");a.province&&t.val(a.province),this.city()},city:function(){d.empty(),a.required||d.append('<option value="">选择年级</option>'),"disabled"==a.nodata?d.prop("disabled",e.isEmptyObject(y)):"hidden"==a.nodata&&d.css("display",e.isEmptyObject(y)?"none":"");for(i in y)d.append('<option value="'+i+'">'+y[i]+"</option>");a.city&&d.val(a.city),this.area()},area:function(){r.empty(),a.required||r.append('<option value="">选择县</option>'),"disabled"==a.nodata?r.prop("disabled",e.isEmptyObject(f)):"hidden"==a.nodata&&r.css("display",e.isEmptyObject(f)?"none":"");for(i in f)r.append('<option value="'+i+'">'+f[i]+"</option>");a.area&&r.val(a.area)}};o.getInfo=function(){var e={direct:!v,province:c[a.province]||"",city:c[a.city]||"",area:c[a.area]||"",code:a.area||a.city||a.province};return e},t.on("change",function(){a.province=e(this).val(),a.city=0,a.area=0,s(),l.city(),a.onChange(o.getInfo())}),d.on("change",function(){a.city=e(this).val(),a.area=0,s(),l.area(),a.onChange(o.getInfo())}),r.on("change",function(){a.area=e(this).val(),a.onChange(o.getInfo())}),s(),l.province(),n(o)}})})}});